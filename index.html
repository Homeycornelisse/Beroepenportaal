<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Beroepen Portaal 2026</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- PDF.js v3 (stabiel met pdfjsLib) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    // worker voor PDF.js v3
    window.addEventListener("load", () => {
      if (window.pdfjsLib) {
        pdfjsLib.GlobalWorkerOptions.workerSrc =
          "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
      }
    });
  </script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'sans-serif'] },
          colors: { brand: { blue: '#1e3a8a', orange: '#f97316', bg: '#f1f5f9' } }
        }
      }
    }
  </script>

  <style>
    .glass { background: rgba(255,255,255,.9); backdrop-filter: blur(10px); }
    textarea { resize: none; min-height: 80px; border: 1px solid #cbd5e1; }
    textarea:focus { border-color: #f97316; outline: none; box-shadow: 0 0 0 2px rgba(249,115,22,.2); }
    @media print { .no-print { display:none; } }
  </style>
</head>

<body class="bg-brand-bg text-slate-900 font-sans leading-relaxed">

  <!-- NAV -->
  <nav class="glass sticky top-0 z-50 border-b border-slate-200 no-print">
    <div class="container mx-auto px-6 py-4 flex flex-wrap gap-3 justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="bg-brand-blue p-2 rounded-lg text-white font-bold text-xl">BP</div>
        <h1 class="text-xl font-bold tracking-tight">Mijn Beroepen Portaal 2026</h1>
        <span id="dataBadge" class="text-xs font-semibold text-slate-500"></span>
      </div>

      <div class="flex flex-wrap gap-3 items-center">
        <button id="tabPortalBtn" class="px-3 py-2 rounded-lg font-bold bg-brand-blue text-white hover:opacity-90">Portaal</button>
        <button id="tabSettingsBtn" class="px-3 py-2 rounded-lg font-bold bg-white border hover:bg-slate-50">Instellingen</button>

        <input type="text" id="searchInput" placeholder="Zoek beroep of sector..." class="p-2 border rounded-lg text-sm w-64">
        <button onclick="window.print()" class="bg-brand-orange text-white px-4 py-2 rounded-lg font-bold shadow-md hover:bg-orange-600 transition">
          Export PDF
        </button>
      </div>
    </div>
  </nav>

  <main class="container mx-auto px-4 py-8 max-w-7xl">

    <!-- PORTAAL -->
    <section id="portalView">
      <section class="mb-6 flex flex-wrap gap-3 no-print">
        <select id="sectorFilter" class="p-3 bg-white border rounded-xl text-sm font-semibold shadow-sm">
          <option value="all">Alle sectoren</option>
        </select>

        <select id="levelFilter" class="p-3 bg-white border rounded-xl text-sm font-semibold shadow-sm">
          <option value="all">Alle niveaus</option>
          <option value="Basis">Basisvakmanschap</option>
          <option value="Middelbaar">Middelbaar</option>
          <option value="Hoger">Hoger</option>
        </select>

        <button id="resetBtn" class="px-4 py-3 rounded-xl bg-white border font-semibold hover:bg-slate-50">
          Filters leegmaken
        </button>

        <div id="statusLine" class="text-sm text-slate-600 flex items-center"></div>
      </section>

      <div id="beroepenContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6"></div>
    </section>

    <!-- INSTELLINGEN -->
    <section id="settingsView" class="hidden">
      <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 max-w-2xl">
        <h2 class="text-xl font-bold text-brand-blue mb-2">Instellingen</h2>
        <p class="text-sm text-slate-600 mb-4">
          Plak de link van de PDF en klik op ‚ÄúUpdate‚Äù.
          Werkt dat niet? Upload de PDF hieronder (dat werkt bijna altijd).
        </p>

        <label class="text-sm font-semibold text-slate-700">PDF-link</label>
        <input id="pdfUrlInput" type="url"
               placeholder="https://www.uwv.nl/.../kansrijke-beroepen-2025-2026.pdf"
               class="mt-2 w-full p-3 border rounded-xl text-sm">

        <div class="flex flex-wrap gap-3 mt-4">
          <button id="savePdfBtn" class="bg-brand-orange text-white px-4 py-2 rounded-lg font-bold hover:bg-orange-600">
            Update (PDF via link)
          </button>
          <button id="useDemoBtn" class="bg-white border px-4 py-2 rounded-lg font-bold hover:bg-slate-50">
            Gebruik demo-data
          </button>
          <button id="clearNotesBtn" class="bg-white border px-4 py-2 rounded-lg font-bold hover:bg-slate-50">
            Mijn notities/keuzes wissen
          </button>
        </div>

        <div class="mt-5">
          <label class="text-sm font-semibold text-slate-700">Of upload de PDF (aanrader als link blokkeert)</label>
          <input id="pdfFileInput" type="file" accept="application/pdf"
                 class="mt-2 w-full p-3 border rounded-xl text-sm bg-white">
          <p class="text-xs text-slate-500 mt-2">
            Uploaden werkt ook als een website de PDF niet laat downloaden via JavaScript.
          </p>
        </div>

        <div id="settingsMsg" class="mt-4 text-sm text-slate-700"></div>

        <div class="mt-6 p-4 rounded-xl bg-slate-50 border text-sm text-slate-700">
          <div class="font-bold mb-2">Belangrijk</div>
          <ul class="list-disc ml-5 space-y-1">
            <li>Open dit bestand via een lokale server (bijv. VS Code Live Server of <span class="font-mono">python -m http.server</span>).</li>
            <li>Gebruik altijd <span class="font-mono">https://</span> links, geen http.</li>
          </ul>
        </div>
      </div>
    </section>

  </main>

  <script>
    // ========= OPSLAG =========
    const STORAGE_KEY = "bp2026_data_v2";
    const STORAGE_PDF_URL = "bp2026_pdf_url_v2";
    const STORAGE_USER_STATE = "bp2026_user_state_v2"; // notes + checkboxes per beroep

    // Demo-data (fallback)
    const demoBeroepen = [
      { s: "Zorg", n: "Huishoudelijk medewerkers", lvl: "Basis", info: "Thuiszorg en particulieren" },
      { s: "Zorg", n: "Helpenden", lvl: "Middelbaar", info: "Ondersteuning bij dagelijkse zorg" },
      { s: "Zorg", n: "(Assistent-)woonbegeleiders", lvl: "Middelbaar", info: "Begeleiding in woonvormen" },
      { s: "Zorg", n: "Verzorgenden IG", lvl: "Middelbaar", info: "Individuele Gezondheidszorg" },
      { s: "Zorg", n: "Verpleegkundigen (MBO/HBO)", lvl: "Middelbaar/Hoger", info: "Algemeen en gespecialiseerd" },
      { s: "Zorg", n: "Doktersassistenten", lvl: "Middelbaar", info: "Praktijkondersteuning" },
      { s: "Zorg", n: "Maatschappelijk werkers", lvl: "Hoger", info: "Sociaal domein" },

      { s: "Bouw", n: "Grondverzet- en Kraanmachinisten", lvl: "Middelbaar", info: "Bediening zwaar materieel" },
      { s: "Bouw", n: "Timmerlieden", lvl: "Middelbaar", info: "Onderhoud en civiele bouw" },
      { s: "Bouw", n: "Schilders en Glaszetters", lvl: "Middelbaar", info: "Vastgoedonderhoud" },

      { s: "Installatie", n: "Elektriciens (incl. zon/laadpalen)", lvl: "Middelbaar", info: "Elektrotechnische installaties" },
      { s: "Installatie", n: "Loodgieters en CV-monteurs", lvl: "Middelbaar", info: "Gas, water en sanitair" },

      { s: "ICT", n: "ICT-servicedeskmedewerkers", lvl: "Middelbaar", info: "Eerste aanspreekpunt techniek" },
      { s: "ICT", n: "Systeem- en Netwerkbeheerders", lvl: "Middelbaar", info: "Beheer van infrastructuren" },
      { s: "ICT", n: "Softwareontwikkelaars", lvl: "Hoger", info: "Bouwen van applicaties" },
      { s: "ICT", n: "Securityspecialisten", lvl: "Hoger", info: "Digitale veiligheid" },

      { s: "Transport - logistiek", n: "Magazijnmedewerkers / Orderpickers", lvl: "Basis", info: "Logistieke afhandeling" },
      { s: "Transport - logistiek", n: "Vrachtwagenchauffeurs", lvl: "Middelbaar", info: "Distributie en transport" },
      { s: "Transport - logistiek", n: "Logistiek planners", lvl: "Middelbaar", info: "Regie op vervoer" },

      { s: "Onderwijs - pedagogisch", n: "Leerkrachten basisonderwijs", lvl: "Hoger", info: "Onderwijs aan kinderen" },
      { s: "Veiligheid", n: "Handhavers (BOA)", lvl: "Middelbaar", info: "Openbare ruimte" },
      { s: "Commercieel ‚Äì HR - strategie", n: "Klantcontact medewerkers", lvl: "Middelbaar", info: "Klantenservice en support" }
    ];

    let beroepen = loadData() || demoBeroepen;
    let userState = loadUserState();

    function saveData(data) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        savedAt: new Date().toISOString(),
        beroepen: data
      }));
      beroepen = data;
      updateBadge();
    }

    function loadData() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return null;
        const obj = JSON.parse(raw);
        return obj?.beroepen || null;
      } catch {
        return null;
      }
    }

    function updateBadge() {
      const badge = document.getElementById("dataBadge");
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) { badge.textContent = ""; return; }
        const obj = JSON.parse(raw);
        const dt = obj?.savedAt ? new Date(obj.savedAt) : null;
        badge.textContent = dt ? `‚Ä¢ Laatst bijgewerkt: ${dt.toLocaleString("nl-NL")}` : "";
      } catch {
        badge.textContent = "";
      }
    }

    function loadUserState() {
      try {
        const raw = localStorage.getItem(STORAGE_USER_STATE);
        if (!raw) return {};
        return JSON.parse(raw) || {};
      } catch {
        return {};
      }
    }

    function saveUserState() {
      localStorage.setItem(STORAGE_USER_STATE, JSON.stringify(userState));
    }

    function setStatus(msg) {
      document.getElementById("statusLine").textContent = msg || "";
    }

    // ========= HELPERS =========
    function normalizeName(x) {
      return (x || "")
        .replace(/\s+/g, " ")
        .replace(/\u00A0/g, " ")
        .trim();
    }

    function escapeHtml(str) {
      return (str || "")
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function cleanBulletName(name) {
      let n = normalizeName(name);
      n = n.replace(/\s*[0-9]+(\s*,\s*[0-9]+)*\s*$/, "");
      n = n.replace(/\s*\u00B9|\u00B2|\u00B3|\u2074|\u2075/g, "");
      return n.trim();
    }

    function keyForBeroep(b) {
      return `${b.s}||${b.n}`.toLowerCase();
    }

    function getUserEntry(b) {
      const k = keyForBeroep(b);
      if (!userState[k]) userState[k] = { like: false, doelgroep: false, note: "" };
      return userState[k];
    }

    function fixHttpsUrl(url) {
      let u = (url || "").trim();
      if (!u) return u;
      // Als iemand per ongeluk "http://" gebruikt, maak er https van
      if (u.startsWith("http://")) u = "https://" + u.slice("http://".length);
      // Als iemand "ttps://" typt, zet h ervoor
      if (u.startsWith("ttps://")) u = "h" + u;
      return u;
    }

    // ========= TABS =========
    const portalView = document.getElementById("portalView");
    const settingsView = document.getElementById("settingsView");
    const tabPortalBtn = document.getElementById("tabPortalBtn");
    const tabSettingsBtn = document.getElementById("tabSettingsBtn");

    function showPortal() {
      portalView.classList.remove("hidden");
      settingsView.classList.add("hidden");
      tabPortalBtn.className = "px-3 py-2 rounded-lg font-bold bg-brand-blue text-white hover:opacity-90";
      tabSettingsBtn.className = "px-3 py-2 rounded-lg font-bold bg-white border hover:bg-slate-50";
    }

    function showSettings() {
      settingsView.classList.remove("hidden");
      portalView.classList.add("hidden");
      tabSettingsBtn.className = "px-3 py-2 rounded-lg font-bold bg-brand-blue text-white hover:opacity-90";
      tabPortalBtn.className = "px-3 py-2 rounded-lg font-bold bg-white border hover:bg-slate-50";
    }

    tabPortalBtn.addEventListener("click", showPortal);
    tabSettingsBtn.addEventListener("click", showSettings);

    // ========= FILTERS =========
    const searchInput = document.getElementById("searchInput");
    const levelFilter = document.getElementById("levelFilter");
    const sectorFilter = document.getElementById("sectorFilter");
    const resetBtn = document.getElementById("resetBtn");

    searchInput.addEventListener("keyup", filterContent);
    levelFilter.addEventListener("change", filterContent);
    sectorFilter.addEventListener("change", filterContent);
    resetBtn.addEventListener("click", () => {
      searchInput.value = "";
      levelFilter.value = "all";
      sectorFilter.value = "all";
      filterContent();
    });

    function refreshSectorDropdown() {
      const sectors = [...new Set(beroepen.map(b => b.s))].sort((a,b)=>a.localeCompare(b,'nl'));
      sectorFilter.innerHTML =
        `<option value="all">Alle sectoren</option>` +
        sectors.map(s => `<option value="${escapeHtml(s)}">${escapeHtml(s)}</option>`).join("");
    }

    function filterContent() {
      const query = (searchInput.value || "").toLowerCase();
      const level = levelFilter.value;
      const sector = sectorFilter.value;
      render(query, level, sector);
    }

    // ========= LINKS VOOR "MEER INFO" =========
    function werkNlZoekUrl(beroepNaam) {
      // Deze werkt als zoek-link. Als Werk.nl ooit verandert, heb je ook de Google-knop erbij.
      return `https://www.werk.nl/werkzoekenden/beroepen-en-opleidingen/beroepen/zoeken?zoekterm=${encodeURIComponent(beroepNaam)}`;
    }

    function googleZoekUrl(beroepNaam) {
      return `https://www.google.com/search?q=${encodeURIComponent(beroepNaam + " beroep taken opleiding")}`;
    }

    // ========= RENDER =========
    function render(filter = "", level = "all", sector = "all") {
      const container = document.getElementById("beroepenContainer");
      container.innerHTML = "";

      const filtered = beroepen.filter(b => {
        const matchQuery =
          b.n.toLowerCase().includes(filter) ||
          b.s.toLowerCase().includes(filter) ||
          (b.info || "").toLowerCase().includes(filter);

        const matchLevel = level === "all" || (b.lvl || "").includes(level);
        const matchSector = sector === "all" || b.s === sector;
        return matchQuery && matchLevel && matchSector;
      });

      setStatus(`Resultaat: ${filtered.length} van ${beroepen.length} beroepen`);

      filtered.forEach(b => {
        const entry = getUserEntry(b);

        const lvlBadgeClass = (b.lvl || "").includes("Hoger")
          ? "bg-blue-100 text-blue-700"
          : ((b.lvl || "").includes("Basis") ? "bg-slate-100 text-slate-700" : "bg-green-100 text-green-700");

        const card = document.createElement("div");
        card.className = "bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-col justify-between";

        card.innerHTML = `
          <div>
            <div class="flex justify-between items-start mb-2 gap-2">
              <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400">${escapeHtml(b.s)}</span>
              <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase ${lvlBadgeClass}">
                ${escapeHtml(b.lvl || "")}
              </span>
            </div>

            <h3 class="text-lg font-bold text-brand-blue mb-1">${escapeHtml(b.n)}</h3>
            <p class="text-[11px] text-slate-500 mb-4">${escapeHtml(b.info || "")}</p>

            <div class="grid grid-cols-2 gap-4 mb-4 border-t border-b border-slate-50 py-3">
              <label class="flex items-center gap-2 cursor-pointer">
                <input data-k="${escapeHtml(keyForBeroep(b))}" data-field="like" type="checkbox" class="w-4 h-4 accent-brand-orange" ${entry.like ? "checked" : ""}>
                <span class="text-xs font-semibold">Past bij mij</span>
              </label>
              <label class="flex items-center gap-2 cursor-pointer">
                <input data-k="${escapeHtml(keyForBeroep(b))}" data-field="doelgroep" type="checkbox" class="w-4 h-4 accent-brand-blue" ${entry.doelgroep ? "checked" : ""}>
                <span class="text-xs font-semibold">Doelgroep-reg.</span>
              </label>
            </div>
          </div>

          <div class="space-y-3">
            <textarea data-k="${escapeHtml(keyForBeroep(b))}" data-field="note"
              placeholder="Mijn tegels: Wat is het gedoe? Wat houdt me tegen?"
              class="w-full bg-slate-50 rounded-xl p-3 text-xs">${escapeHtml(entry.note || "")}</textarea>

            <div class="flex flex-wrap gap-2 items-center">
              <a href="${werkNlZoekUrl(b.n)}" target="_blank" rel="noopener"
                 class="text-[10px] font-bold text-brand-blue hover:text-brand-orange flex items-center gap-1">
                ‚ÑπÔ∏è Werk.nl: meer info
              </a>

              <span class="text-slate-300 text-xs">|</span>

              <a href="${googleZoekUrl(b.n)}" target="_blank" rel="noopener"
                 class="text-[10px] font-bold text-slate-600 hover:text-brand-orange flex items-center gap-1">
                üîé Google: beroep uitleg
              </a>
            </div>
          </div>
        `;

        container.appendChild(card);
      });

      // Opslaan checkboxen
      container.querySelectorAll("input[type=checkbox]").forEach(cb => {
        cb.addEventListener("change", (e) => {
          const k = e.target.getAttribute("data-k");
          const field = e.target.getAttribute("data-field");
          userState[k] = userState[k] || { like:false, doelgroep:false, note:"" };
          userState[k][field] = e.target.checked;
          saveUserState();
        });
      });

      // Opslaan notities
      container.querySelectorAll("textarea").forEach(ta => {
        ta.addEventListener("input", (e) => {
          const k = e.target.getAttribute("data-k");
          const field = e.target.getAttribute("data-field");
          userState[k] = userState[k] || { like:false, doelgroep:false, note:"" };
          userState[k][field] = e.target.value;
          saveUserState();
        });
      });
    }

    // ========= PDF PARSEN =========
    const SECTORS = new Set([
      "Bouw",
      "Installatie",
      "Voertuigentechniek",
      "Industrie",
      "Transport - logistiek",
      "Veiligheid",
      "Detailhandel",
      "Horeca",
      "Landbouw, natuur en milieu",
      "Schoonmaak - reiniging",
      "Commercieel ‚Äì HR - strategie",
      "Financieel en administratie ‚Äì juridisch",
      "ICT",
      "Overheid",
      "Onderwijs - pedagogisch",
      "Zorg"
    ]);

    function normalizeLineForCompare(line) {
      return normalizeName(line)
        .replaceAll("‚Äì","-")
        .replace(/\s*-\s*/g, " - ")
        .trim();
    }

    function levelFromLine(line) {
      const t = normalizeLineForCompare(line).toLowerCase();
      if (t.startsWith("basisvakmanschap")) return "Basis";
      if (t.startsWith("middelbaar beroepsniveau")) return "Middelbaar";
      if (t.startsWith("hoger / wetenschappelijk")) return "Hoger";
      return null;
    }

    function isSectorLine(line) {
      const t = normalizeLineForCompare(line);
      for (const s of SECTORS) {
        if (t === normalizeLineForCompare(s)) return s;
      }
      return null;
    }

    function ensurePdfLib() {
      if (!window.pdfjsLib) throw new Error("PDF.js is niet geladen. Check je internet of script-tag.");
      // worker is al gezet in head (maar voor de zekerheid)
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js";
    }

    async function extractTextFromPdfBytes(arrayBuffer) {
      ensurePdfLib();
      const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;

      let fullText = "";
      for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const pageText = content.items.map(it => it.str).join("\n");
        fullText += "\n" + pageText + "\n";
      }
      return fullText;
    }

    async function extractTextFromPdfUrl(url) {
      const fixed = fixHttpsUrl(url);
      const resp = await fetch(fixed);
      if (!resp.ok) throw new Error("PDF downloaden lukt niet. Check of de link klopt of dat de website blokkeert.");
      const bytes = await resp.arrayBuffer();
      return extractTextFromPdfBytes(bytes);
    }

    async function extractTextFromPdfFile(file) {
      const bytes = await file.arrayBuffer();
      return extractTextFromPdfBytes(bytes);
    }

    function parseBeroepenFromText(text) {
      const lines = (text || "")
        .split("\n")
        .map(l => normalizeName(l))
        .filter(Boolean);

      let currentSector = null;
      let currentLevel = null;

      const out = [];

      for (const raw of lines) {
        const sectorHit = isSectorLine(raw);
        if (sectorHit) {
          currentSector = sectorHit;
          currentLevel = null;
          continue;
        }

        const lvl = levelFromLine(raw);
        if (lvl) {
          currentLevel = lvl;
          continue;
        }

        // bullets (vaak "‚ñ™")
        if (raw.startsWith("‚ñ™")) {
          const name = cleanBulletName(raw.replace(/^‚ñ™\s*/, ""));
          if (!name) continue;

          if (currentSector && currentLevel) {
            out.push({
              s: currentSector,
              n: name,
              lvl: currentLevel,
              info: "Uit UWV-lijst kansrijke beroepen"
            });
          }
        }
      }

      // dubbelen weg
      const seen = new Set();
      const unique = [];
      for (const b of out) {
        const k = keyForBeroep(b);
        if (seen.has(k)) continue;
        seen.add(k);
        unique.push(b);
      }

      const lvlOrder = { "Basis": 1, "Middelbaar": 2, "Hoger": 3 };
      unique.sort((a,b) => {
        const s = a.s.localeCompare(b.s, "nl");
        if (s !== 0) return s;
        const l = (lvlOrder[a.lvl] || 9) - (lvlOrder[b.lvl] || 9);
        if (l !== 0) return l;
        return a.n.localeCompare(b.n, "nl");
      });

      return unique;
    }

    // ========= INSTELLINGEN UI =========
    const pdfUrlInput = document.getElementById("pdfUrlInput");
    const savePdfBtn = document.getElementById("savePdfBtn");
    const useDemoBtn = document.getElementById("useDemoBtn");
    const clearNotesBtn = document.getElementById("clearNotesBtn");
    const settingsMsg = document.getElementById("settingsMsg");
    const pdfFileInput = document.getElementById("pdfFileInput");

    function setSettingsMsg(msg, ok=true) {
      settingsMsg.innerHTML = `<span class="${ok ? "text-emerald-700" : "text-rose-700"} font-semibold">${escapeHtml(msg)}</span>`;
    }

    savePdfBtn.addEventListener("click", async () => {
      const url = fixHttpsUrl(pdfUrlInput.value || "");
      if (!url) {
        setSettingsMsg("Vul eerst een PDF-link in.", false);
        return;
      }

      setSettingsMsg("Bezig met PDF ophalen en inlezen‚Ä¶", true);

      try {
        localStorage.setItem(STORAGE_PDF_URL, url);

        const text = await extractTextFromPdfUrl(url);
        const parsed = parseBeroepenFromText(text);

        if (!parsed.length) {
          setSettingsMsg("Ik kon geen beroepen vinden in deze PDF. Probeer anders uploaden.", false);
          return;
        }

        saveData(parsed);
        refreshSectorDropdown();
        filterContent();

        setSettingsMsg(`Klaar! ${parsed.length} beroepen zijn ingeladen via link.`, true);
        showPortal();
      } catch (e) {
        setSettingsMsg(`Mislukt: ${e.message} (Tip: probeer uploaden)`, false);
      }
    });

    pdfFileInput.addEventListener("change", async () => {
      const file = pdfFileInput.files?.[0];
      if (!file) return;

      setSettingsMsg("Bezig met PDF upload inlezen‚Ä¶", true);

      try {
        const text = await extractTextFromPdfFile(file);
        const parsed = parseBeroepenFromText(text);

        if (!parsed.length) {
          setSettingsMsg("Ik kon geen beroepen vinden in deze PDF.", false);
          return;
        }

        saveData(parsed);
        refreshSectorDropdown();
        filterContent();

        setSettingsMsg(`Klaar! ${parsed.length} beroepen zijn ingeladen via upload.`, true);
        showPortal();
      } catch (e) {
        setSettingsMsg(`Mislukt: ${e.message}`, false);
      }
    });

    useDemoBtn.addEventListener("click", () => {
      saveData(demoBeroepen);
      refreshSectorDropdown();
      filterContent();
      setSettingsMsg("Demo-data staat aan.", true);
      showPortal();
    });

    clearNotesBtn.addEventListener("click", () => {
      localStorage.removeItem(STORAGE_USER_STATE);
      userState = {};
      setSettingsMsg("Alles gewist: je notities en vinkjes zijn verwijderd.", true);
      filterContent();
    });

    // ========= START =========
    function init() {
      updateBadge();

      const savedUrl = localStorage.getItem(STORAGE_PDF_URL);
      if (savedUrl) pdfUrlInput.value = savedUrl;

      refreshSectorDropdown();
      render();

      const loaded = loadData();
      if (loaded && loaded.length && loaded !== demoBeroepen) {
        setStatus(`Data geladen uit opslag: ${beroepen.length} beroepen`);
      } else {
        setStatus(`Demo-data actief: ${beroepen.length} beroepen`);
      }
    }

    init();
  </script>

</body>
</html>