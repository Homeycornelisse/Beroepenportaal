<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>Kansrijke Beroepen Portaal 2025-2026</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['DM Sans', 'sans-serif'], mono: ['DM Mono', 'monospace'] },
          colors: { uwv: { blue: '#003082', mid: '#0055b3', light: '#e8f0fb', orange: '#e85d00', bg: '#f4f6fb' } }
        }
      }
    };
  </script>

  <style>
    :root { --blue:#003082; --mid:#0055b3; --orange:#e85d00; --bg:#f4f6fb; }
    body { font-family: 'DM Sans', sans-serif; }

    textarea { resize: none; min-height: 72px; }
    textarea:focus { outline: none; border-color: var(--orange); box-shadow: 0 0 0 2px rgba(232,93,0,.15); }

    .card { transition: box-shadow .15s, transform .15s; }
    .card:hover { box-shadow: 0 8px 24px rgba(0,48,130,.1); transform: translateY(-1px); }

    .lvl-basis { background:#fef3c7; color:#92400e; }
    .lvl-mid   { background:#dcfce7; color:#166534; }
    .lvl-hoger { background:#dbeafe; color:#1e40af; }

    @media print {
      .no-print { display: none !important; }
      body { background: white !important; margin: 0; padding: 0; }
      #portalView, #settingsView { display: none !important; }
      #exportView { display: block !important; }

      .export-banner {
        background: linear-gradient(135deg, #003082 0%, #0055b3 100%) !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
        color: white !important;
      }
      .export-sector-header {
        background: #e8f0fb !important;
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .export-lvl-badge {
        -webkit-print-color-adjust: exact;
        print-color-adjust: exact;
      }
      .export-card { border: 1px solid #e2e8f0 !important; break-inside: avoid; }
    }

    .export-banner {
      background: linear-gradient(135deg, #003082 0%, #0055b3 100%);
      padding: 32px 40px;
      color: white;
      border-radius: 0 0 16px 16px;
    }
  </style>

  <style id="printPageStyle"></style>
</head>

<body class="bg-uwv-bg text-slate-900" style="min-height:100vh;">

  <!-- NAV -->
  <nav class="bg-white sticky top-0 z-50 border-b border-slate-200 no-print shadow-sm">
    <div class="max-w-7xl mx-auto px-5 py-3 flex flex-wrap gap-3 justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="rounded-lg p-1.5" style="background:var(--blue);">
          <svg width="26" height="26" viewBox="0 0 26 26" fill="none">
            <rect width="26" height="26" rx="6" fill="#003082"/>
            <text x="5" y="19" font-size="14" font-weight="700" fill="white" font-family="DM Sans">BP</text>
          </svg>
        </div>
        <div>
          <div class="font-bold text-base leading-tight" style="color:var(--blue)">Kansrijke Beroepen Portaal</div>
          <div id="dataBadge" class="text-xs text-slate-400 font-mono leading-tight"></div>
        </div>
      </div>

      <div class="flex flex-wrap gap-2 items-center">
        <button id="tabPortalBtn" onclick="showPortal()" class="px-3 py-1.5 rounded-lg text-sm font-semibold transition-all">Portaal</button>
        <button id="tabSettingsBtn" onclick="showSettings()" class="px-3 py-1.5 rounded-lg text-sm font-semibold transition-all">Instellingen</button>

        <input type="text" id="searchInput" placeholder="Zoek beroep of sector…"
               class="p-2 border border-slate-200 rounded-lg text-sm w-56 focus:border-blue-400 focus:ring-1 focus:ring-blue-100 outline-none">

        <button id="exportBtn"
                class="text-white px-4 py-2 rounded-lg text-sm font-bold shadow hover:opacity-90 transition"
                style="background:var(--orange);">
          ⬇ Export mijn selectie
        </button>
      </div>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 py-7">

    <!-- PORTAAL -->
    <section id="portalView">

      <div id="pdfBanner" class="hidden no-print mb-5">
        <div class="bg-amber-50 border border-amber-200 rounded-2xl p-4 flex flex-wrap items-center justify-between gap-3">
          <div>
            <div class="font-bold text-amber-900">Tip: upload eerst de UWV PDF</div>
            <div class="text-sm text-amber-800">
              Dan werken de "Meer info" links precies zoals in de PDF. Zonder upload gebruiken we zoeklinks.
            </div>
          </div>
          <button onclick="showSettings()"
            class="px-4 py-2 rounded-xl text-sm font-bold text-white hover:opacity-90 transition"
            style="background:var(--orange);">
            Ga naar instellingen
          </button>
        </div>
      </div>

      <!-- Filters -->
      <div class="flex flex-wrap gap-3 mb-6 no-print">
        <select id="sectorFilter" class="p-2.5 bg-white border border-slate-200 rounded-xl text-sm font-medium shadow-sm outline-none focus:border-blue-400">
          <option value="all">Alle sectoren</option>
        </select>

        <select id="levelFilter" class="p-2.5 bg-white border border-slate-200 rounded-xl text-sm font-medium shadow-sm outline-none focus:border-blue-400">
          <option value="all">Alle niveaus</option>
          <option value="Basis">Basisvakmanschap</option>
          <option value="Middelbaar">Middelbaar</option>
          <option value="Hoger">Hoger</option>
        </select>

        <select id="selectedFilter" class="p-2.5 bg-white border border-slate-200 rounded-xl text-sm font-medium shadow-sm outline-none focus:border-blue-400">
          <option value="all">Alles tonen</option>
          <option value="selected">Alleen aangevinkt</option>
        </select>

        <button onclick="resetFilters()" class="px-3 py-2.5 rounded-xl bg-white border border-slate-200 text-sm font-medium hover:bg-slate-50 transition">
          Filters wissen
        </button>

        <div id="statusLine" class="text-sm text-slate-500 flex items-center font-mono"></div>
      </div>

      <div id="beroepenContainer" class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-5"></div>
    </section>

    <!-- INSTELLINGEN -->
    <section id="settingsView" class="hidden no-print">
      <div class="bg-white rounded-2xl p-7 shadow-sm border border-slate-200 max-w-xl">
        <h2 class="text-lg font-bold mb-1" style="color:var(--blue)">Instellingen</h2>
        <p class="text-sm text-slate-500 mb-5">
          Upload de UWV PDF om de gegevens bij te werken. Dan worden ook de "Meer info" links exact zoals in de PDF.
          Zonder upload gebruiken we een zoeklink als fallback.
        </p>

        <div class="p-4 rounded-xl bg-slate-50 border border-slate-200 mb-5">
          <div class="text-sm font-semibold text-slate-700 mb-1">Officiële UWV bron</div>
          <p class="text-xs text-slate-500 mb-3">Download de nieuwste PDF met kansrijke beroepen.</p>
          <a href="https://www.uwv.nl/nl/arbeidsmarktinformatie/kansen-beroep/kansrijke-beroepen"
             target="_blank" rel="noopener"
             class="inline-block text-white px-4 py-2 rounded-lg text-sm font-bold hover:opacity-90 transition"
             style="background:var(--blue);">
            Ga naar UWV.nl
          </a>
        </div>

        <div class="mb-4">
          <label class="text-sm font-semibold text-slate-700 block mb-2">Eigen PDF uploaden</label>
          <input id="pdfFileInput" type="file" accept="application/pdf"
                 class="w-full p-3 border border-slate-200 rounded-xl text-sm bg-white">
          <p class="text-xs text-slate-400 mt-1">Parseren kan een paar seconden duren.</p>
        </div>

        <div class="mb-5">
          <label class="text-sm font-semibold text-slate-700 block mb-2">Export oriëntatie</label>
          <select id="printOrientation" class="w-full p-2.5 bg-white border border-slate-200 rounded-xl text-sm font-medium outline-none focus:border-blue-400">
            <option value="portrait">Staand (A4 portrait)</option>
            <option value="landscape">Liggend (A4 landscape)</option>
          </select>
        </div>

        <div class="flex flex-wrap gap-3">
          <button onclick="loadDefault()" class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 transition">
            Standaard 2025–2026 laden
          </button>
          <button onclick="clearUserState()" class="bg-white border border-slate-200 px-4 py-2 rounded-lg text-sm font-semibold hover:bg-slate-50 transition">
            Mijn notities wissen
          </button>
        </div>

        <div id="settingsMsg" class="mt-4 text-sm"></div>
      </div>
    </section>

    <!-- EXPORT VIEW (print only) -->
    <section id="exportView" class="hidden">
      <div class="export-banner">
        <div class="flex items-start justify-between flex-wrap gap-4">
          <div>
            <div class="text-xs font-bold uppercase tracking-widest opacity-70 mb-1">Kansrijke Beroepen Portaal 2025–2026</div>
            <h1 class="text-3xl font-bold mb-1">Mijn geselecteerde beroepen</h1>
            <div id="exportSubtitle" class="text-sm opacity-80"></div>
          </div>
          <div class="text-right">
            <div class="text-xs opacity-60 mb-1">Bron: UWV</div>
            <div id="exportMeta" class="text-xs opacity-60"></div>
          </div>
        </div>
      </div>

      <div class="flex flex-wrap gap-3 mt-5 mb-6 px-1">
        <div class="flex items-center gap-2 text-xs text-slate-600">
          <span class="px-2 py-0.5 rounded font-bold export-lvl-badge lvl-basis">BASIS</span> Basisvakmanschap
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-600">
          <span class="px-2 py-0.5 rounded font-bold export-lvl-badge lvl-mid">MBO</span> Middelbaar beroepsniveau
        </div>
        <div class="flex items-center gap-2 text-xs text-slate-600">
          <span class="px-2 py-0.5 rounded font-bold export-lvl-badge lvl-hoger">HBO/WO</span> Hoger / wetenschappelijk
        </div>
      </div>

      <div id="exportList" class="space-y-6"></div>

      <div class="mt-8 pt-4 border-t border-slate-200 text-xs text-slate-400">
        UWV Kansrijke Beroepen 2025–2026 · uwv.nl · Gegenereerd via Beroepen Portaal
      </div>
    </section>

  </main>

  <script>
  // =====================================================================
  // INGEBOUWDE DATASET (UWV Kansrijke Beroepen 2025-2026)
  // =====================================================================
  const INGEBOUWDE_DATA = [
    {"s":"Bouw","n":"Grondverzetmachinisten","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Heimachinisten","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Kraanmachinisten","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Vaklieden grond-, weg- en waterbouw","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Rioleringsmedewerkers","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Stratenmakers","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Sondeerders en boormeesters grondboring","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Slopers bouw en asbestverwijderaars","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Betonwerkers","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Isoleerders","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Onderhoudsmedewerkers gebouwen","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Steigerbouwers","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Tegelzetters","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Dakdekkers","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Timmerlieden (onderhoud en civiele bouw)","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Schilders","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Glaszetters","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Werkplaatstimmermannen, interieurbouwers, standbouwers, wand- en plafondmonteurs","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Rolluik- en zonweringinstallateurs","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Landmeters","lvl":"Middelbaar"},
    {"s":"Bouw","n":"(Hoofd)uitvoerders grond-, weg- en waterbouw","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Opzichters en beheerders grond-, weg- en waterbouw","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Werkvoorbereiders en calculatoren grond-, weg- en waterbouw","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Tekenaars grond-, weg- en waterbouw","lvl":"Middelbaar"},
    {"s":"Bouw","n":"(Hoofd)uitvoerders bouw en installatietechniek","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Werkvoorbereiders en calculatoren bouw en installatietechniek","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Tekenaars bouwkunde en BIM modelleurs","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Bouwkundig inspecteurs, opzichters en adviseurs (EPA- en BENG adviseurs)","lvl":"Middelbaar"},
    {"s":"Bouw","n":"Bodemkundig onderzoekers en -saneerders","lvl":"Hoger"},
    {"s":"Bouw","n":"Adviseurs en ontwerper-constructeurs grond-, weg- en waterbouw","lvl":"Hoger"},
    {"s":"Bouw","n":"Projectleiders grond-, weg- en waterbouw","lvl":"Hoger"},
    {"s":"Bouw","n":"Adviseurs en ontwerper-constructeurs bouwkunde","lvl":"Hoger"},
    {"s":"Bouw","n":"Managers en projectleiders bouw en installatie","lvl":"Hoger"},
    {"s":"Installatie","n":"Monteurs en leidingleggers gas, water","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Kabelwerkers en monteurs datacommunicatie","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Monteurs glasvezel en telecommunicatiesystemen","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Monteurs laag-, midden- en hoogspanning","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Loodgieters, installateurs en monteurs gas, water, sanitair, verwarming","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Elektriciens, installateurs en monteurs elektrische installaties (incl. zonnepanelen en laadpalen)","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Installateurs en monteurs luchtbehandeling, koeltechniek","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Monteurs lifttechniek en elektromotoren","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Monteurs beveiligingsinstallaties","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Medewerkers technische dienst (elektrotechnisch)","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Monteurs meet- en regeltechniek en medische elektronica","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Tekenaars installatietechniek","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Tekenaars elektrotechniek","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Werkvoorbereiders en calculatoren elektrotechniek","lvl":"Middelbaar"},
    {"s":"Installatie","n":"Adviseurs, engineers en projectleiders installatietechniek","lvl":"Hoger"},
    {"s":"Installatie","n":"Inspecteurs elektrische installaties","lvl":"Hoger"},
    {"s":"Installatie","n":"Projectleiders elektrotechniek","lvl":"Hoger"},
    {"s":"Installatie","n":"Engineers, constructeurs en onderzoekers elektrotechnische installaties","lvl":"Hoger"},
    {"s":"Installatie","n":"Engineers elektronica en meet- en regeltechniek","lvl":"Hoger"},
    {"s":"Installatie","n":"Telecom engineers","lvl":"Hoger"},
    {"s":"Voertuigentechniek","n":"Rijwielmonteurs","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Autospuiters","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Autoschadeherstellers (incl. caravan-/campermonteur)","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Automonteurs (personen- en bedrijfswagens)","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Werkplaatschefs auto","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Monteurs mobiele werktuigen (incl. landbouwmachines)","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Elektromonteurs schepen en treinen","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Scheepswerktuigkundigen","lvl":"Middelbaar"},
    {"s":"Voertuigentechniek","n":"Bedrijfsleiders / ondernemers autogaragebedrijf","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Verf- en lakspuiters","lvl":"Basis"},
    {"s":"Industrie","n":"Assemblagemedewerkers","lvl":"Basis"},
    {"s":"Industrie","n":"Assemblagemonteurs","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Pijpfitters","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Plaatwerkers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"CNC-machinebedieners","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Conventioneel verspaners en machinebankwerkers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"CNC-verspaners (inclusief programmeren)","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Constructiebankwerkers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Constructiemedewerkers en carrosseriebouwers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Lassers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Gespecialiseerd lassers, operators lasrobot","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Gereedschapsmakers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Fijninstrumentmakers en fijnmechanici","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Machinaal meubelmakers en houtbewerkers","lvl":"Middelbaar"},
    {"s":"Industrie","n":"(Hoofd)operators proces- en levensmiddelenindustrie","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Monteurs industriële machines en installaties / mechatronica (installatie, service, storing)","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Order- en productiebegeleiders industrie (binnendienst)","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Productieplanners","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Tekenaars werktuigbouw / machines","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Werkvoorbereiders en calculatoren werktuigbouw / machines","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Calculatoren procestechniek","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Vertegenwoordigers en accountmanagers technische producten","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Leidinggevenden assemblage en montage metaal- en overige industrie","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Technisch managers en hoofden technische dienst","lvl":"Middelbaar"},
    {"s":"Industrie","n":"Adviseurs, (maintenance)engineers en ontwerper-constructeurs werktuigbouw en machines","lvl":"Hoger"},
    {"s":"Industrie","n":"Managers en teamleiders R&D productontwikkeling","lvl":"Hoger"},
    {"s":"Industrie","n":"Proces- en levensmiddelentechnologen, productontwikkelaars","lvl":"Hoger"},
    {"s":"Industrie","n":"Biochemisch en microbiologisch analisten / laboranten","lvl":"Hoger"},
    {"s":"Industrie","n":"Chemisch en fysisch analisten","lvl":"Hoger"},
    {"s":"Industrie","n":"Leidinggevenden proces- en levensmiddelenindustrie","lvl":"Hoger"},
    {"s":"Industrie","n":"Managers en teamleiders R&D laboratorium (chemische en levensmiddelenindustrie)","lvl":"Hoger"},
    {"s":"Industrie","n":"Engineers hardware en industriële automatisering, PLC-programmeurs, embedded software engineers","lvl":"Hoger"},
    {"s":"Industrie","n":"Projectleiders elektronica en industriële automatisering","lvl":"Hoger"},
    {"s":"Industrie","n":"Kwaliteitsmedewerkers, QA managers","lvl":"Hoger"},
    {"s":"Industrie","n":"Managers en bedrijfsleiders industrie","lvl":"Hoger"},
    {"s":"Transport - logistiek","n":"Magazijn-, expeditiemedewerkers en orderpickers","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Heftruckchauffeurs","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Bijrijders, laders en lossers","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Beladers vuilniswagen, vuilnisophalers","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Bestelwagenchauffeurs en -bezorgers (bijv. supermarkten)","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Fiets- en brommerkoeriers, postbezorgers","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Verhuizers","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Rangeerders","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Taxichauffeurs groepsvervoer","lvl":"Basis"},
    {"s":"Transport - logistiek","n":"Vrachtwagenchauffeurs","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Buschauffeurs lijndienst","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Buschauffeurs touringcar","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Conducteurs","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Treinmachinisten","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Matrozen binnenvaart","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Schippers binnenvaart","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Matrozen zeevaart","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Maritiem officieren","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Logistiek (administratief) medewerkers","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Leidinggevenden magazijn, magazijnchefs","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Declaranten, expediteurs en exportmedewerkers binnendienst","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"Transportplanners","lvl":"Middelbaar"},
    {"s":"Transport - logistiek","n":"(Trein)verkeersleiders","lvl":"Hoger"},
    {"s":"Transport - logistiek","n":"Logistiek managers","lvl":"Hoger"},
    {"s":"Veiligheid","n":"Verkeersregelaars","lvl":"Basis"},
    {"s":"Veiligheid","n":"Brandwachten / heetwerkwachten","lvl":"Basis"},
    {"s":"Veiligheid","n":"Handhavers openbare ruimte (BOA's en toezichthouders)","lvl":"Middelbaar"},
    {"s":"Veiligheid","n":"(Complex)beveiligers penitentiaire inrichting","lvl":"Middelbaar"},
    {"s":"Veiligheid","n":"Objectbeveiligers","lvl":"Middelbaar"},
    {"s":"Veiligheid","n":"Meldkamermedewerkers","lvl":"Middelbaar"},
    {"s":"Veiligheid","n":"Adviseurs brandveiligheid","lvl":"Middelbaar"},
    {"s":"Veiligheid","n":"Veiligheidskundigen","lvl":"Hoger"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers tankstation","lvl":"Basis"},
    {"s":"Detailhandel","n":"Kassamedewerkers","lvl":"Basis"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers food (voedingsspeciaalzaken)","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Brood- en banketbakkers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Slagers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Kappers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers mode (kleding en schoenen)","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Schoenmakers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers juwelier","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers optiek","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Opticiens","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Audiciens","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers drogisterij","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers zorgartikelen en -zelfhulpmiddelen","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers tuincentrum","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Autoverkopers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers elektronica","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Monteurs consumentenelektronica","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Monteurs witgoed","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers bouwmarkten en doe-het-zelf","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Verkoopmedewerkers woninginrichting (keukens / badkamers)","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Woninginrichters, vloerenleggers en keukenmonteurs","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"Visual merchandisers","lvl":"Middelbaar"},
    {"s":"Detailhandel","n":"(Afdelings)managers / bedrijfsleiders supermarkt","lvl":"Hoger"},
    {"s":"Horeca","n":"Afwassers","lvl":"Basis"},
    {"s":"Horeca","n":"Keukenassistenten","lvl":"Basis"},
    {"s":"Horeca","n":"Medewerkers fastservice (in o.a. snackbars, ijssalons, lunchrooms)","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Cateringmedewerkers","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Medewerkers banqueting","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Medewerkers bediening horeca","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Barpersoneel","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Restaurantkoks","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Hotelreceptionisten","lvl":"Middelbaar"},
    {"s":"Horeca","n":"Managers horeca","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"Loonwerkers, landbouwmachinisten en tractorchauffeurs","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"(Voorman) hoveniers / groenonderhoud, boomverzorgers, greenkeepers","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"(Vakbekwaam) medewerkers boomkwekerij","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"(Vakbekwaam / zelfstandig) medewerkers teelt","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"Meewerkend voormannen / teamleiders / (assistent) bedrijfsleiders teelt","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"Medewerkers zaadteelt en plantenveredeling","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"Medewerkers dier- en veehouderij","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"(Assistent) bedrijfsleiders dier- en veehouderij","lvl":"Middelbaar"},
    {"s":"Landbouw, natuur en milieu","n":"Medewerkers bos- en natuurbeheer, ecologen, landschapsbeheerders / rentmeesters","lvl":"Middelbaar"},
    {"s":"Schoonmaak - reiniging","n":"Schoonmakers (o.a. kantoren, bedrijven, hotels, vakantieparken)","lvl":"Basis"},
    {"s":"Schoonmaak - reiniging","n":"Gespecialiseerde schoonmakers (industrieel, calamiteiten, cleanrooms)","lvl":"Basis"},
    {"s":"Schoonmaak - reiniging","n":"Glazenwassers","lvl":"Basis"},
    {"s":"Schoonmaak - reiniging","n":"Medewerkers autowasstraat","lvl":"Basis"},
    {"s":"Schoonmaak - reiniging","n":"Ongediertebestrijders","lvl":"Basis"},
    {"s":"Schoonmaak - reiniging","n":"Teamleiders en voormannen schoonmaak","lvl":"Middelbaar"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Medewerkers klantcontact / klantenservice","lvl":"Middelbaar"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Supervisors klantcontact / klantenservice","lvl":"Middelbaar"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Commercieel medewerkers binnendienst","lvl":"Middelbaar"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Reisadviseurs","lvl":"Middelbaar"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Taxateurs onroerend goed","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Vastgoedmanagers en -beheerders","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Business consultants, (technisch) organisatieadviseurs en kwaliteitsmanagers","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Online marketeers","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Communicatie- en pr-adviseurs","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"HR-adviseurs","lvl":"Hoger"},
    {"s":"Commercieel \u2013 HR - strategie","n":"Recruiters","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Incassomedewerkers","lvl":"Middelbaar"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Juridisch secretaressen","lvl":"Middelbaar"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Directiesecretaresses en managementassistenten","lvl":"Middelbaar"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Personeelsplanners en roostermakers","lvl":"Middelbaar"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Boekhouders en financieel administrateurs","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Salarisadministrateurs","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Schadebehandelaars","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Assurantieadviseurs, acceptanten verzekeringsmaatschappij","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Adviseurs hypotheken, kredieten en subsidies","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Financieel- en beleggingsspecialisten, treasurers","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"(Assistent) controllers, auditors en compliance officers","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"AA- en assistent accountants","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"(Register)accountants","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Belastingadviseurs","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Managers inkoop","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"(Assistent) inkopers en contractmanagers","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Bewindvoerders","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Juridisch medewerkers","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Juristen en juridisch specialisten","lvl":"Hoger"},
    {"s":"Financieel en administratie \u2013 juridisch","n":"Advocaten","lvl":"Hoger"},
    {"s":"ICT","n":"ICT-servicedeskmedewerkers","lvl":"Middelbaar"},
    {"s":"ICT","n":"Applicatie- en functioneel beheerders","lvl":"Middelbaar"},
    {"s":"ICT","n":"Systeembeheerders","lvl":"Middelbaar"},
    {"s":"ICT","n":"Databasebeheerders","lvl":"Middelbaar"},
    {"s":"ICT","n":"Netwerkbeheerders","lvl":"Middelbaar"},
    {"s":"ICT","n":"Database- en datawarehouse ontwikkelaars","lvl":"Hoger"},
    {"s":"ICT","n":"Softwareontwikkelaars","lvl":"Hoger"},
    {"s":"ICT","n":"Programmeurs en developers ICT","lvl":"Hoger"},
    {"s":"ICT","n":"Webdevelopers (technisch / backend)","lvl":"Hoger"},
    {"s":"ICT","n":"GEO / GIS specialisten (geografisch informatiesysteem)","lvl":"Hoger"},
    {"s":"ICT","n":"Software testers, testmanagers ICT","lvl":"Hoger"},
    {"s":"ICT","n":"Securityspecialisten ICT","lvl":"Hoger"},
    {"s":"ICT","n":"Netwerkspecialisten / netwerkengineers","lvl":"Hoger"},
    {"s":"ICT","n":"Ontwerpers / architecten ICT-systemen","lvl":"Hoger"},
    {"s":"ICT","n":"BI (business intelligence) specialisten","lvl":"Hoger"},
    {"s":"ICT","n":"Data analisten, data scientists en actuarissen","lvl":"Hoger"},
    {"s":"ICT","n":"Adviseurs, consultants en informatiespecialisten ICT","lvl":"Hoger"},
    {"s":"Overheid","n":"Medewerkers burgerzaken","lvl":"Middelbaar"},
    {"s":"Overheid","n":"Penitentiair inrichtingswerkers","lvl":"Middelbaar"},
    {"s":"Overheid","n":"Politieagenten","lvl":"Middelbaar"},
    {"s":"Overheid","n":"Beroepsmilitairen","lvl":"Middelbaar"},
    {"s":"Overheid","n":"Vergunningverleners ruimtelijke ordening","lvl":"Hoger"},
    {"s":"Overheid","n":"Maatschappelijk werkers / sociaal werkers","lvl":"Hoger"},
    {"s":"Overheid","n":"Reclasseringswerkers","lvl":"Hoger"},
    {"s":"Overheid","n":"Beleidsadviseurs sociaal domein","lvl":"Hoger"},
    {"s":"Overheid","n":"Beleidsadviseurs onderwijs en jeugd","lvl":"Hoger"},
    {"s":"Overheid","n":"Beleidsadviseurs bestuurlijk-juridisch","lvl":"Hoger"},
    {"s":"Overheid","n":"Beleidsadviseurs economie, planeconomen","lvl":"Hoger"},
    {"s":"Overheid","n":"Beleidsadviseurs (inclusief managers) ruimtelijke ordening / planologie, milieu","lvl":"Hoger"},
    {"s":"Overheid","n":"Verkeersplanologen","lvl":"Hoger"},
    {"s":"Overheid","n":"Planologen en stedenbouwkundigen","lvl":"Hoger"},
    {"s":"Overheid","n":"Landschapsarchitecten","lvl":"Hoger"},
    {"s":"Overheid","n":"Milieu-inspecteurs","lvl":"Hoger"},
    {"s":"Overheid","n":"Hydrologen en milieutechnologen / adviseurs waterbeheer","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Zweminstructeurs","lvl":"Middelbaar"},
    {"s":"Onderwijs - pedagogisch","n":"Fitnessinstructeurs","lvl":"Middelbaar"},
    {"s":"Onderwijs - pedagogisch","n":"(Pedagogisch) medewerkers kinderopvang","lvl":"Middelbaar"},
    {"s":"Onderwijs - pedagogisch","n":"Technisch onderwijsassistenten (TOA)","lvl":"Middelbaar"},
    {"s":"Onderwijs - pedagogisch","n":"Leerkrachten basisonderwijs","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Leerkrachten speciaal onderwijs en RT","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten lichamelijke opvoeding","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten vo / mbo taalkundige vakken","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten vo / mbo exacte vakken","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten vo / mbo economische vakken","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten vo maatschappelijke vakken","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten vo cultuur en kunstvakken","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Vakdocenten beroepsonderwijs techniek","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Vakdocenten beroepsonderwijs verpleegkunde / verzorging","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"NT2 docenten (mits in bezit van 2e graads onderwijsbevoegdheid)","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Managers kinderdagverblijven","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Directeuren / schoolleiders basis- en speciaal onderwijs","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Directeuren en managers voortgezet onderwijs en mbo","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten hbo / wo wis- en natuurkunde, techniek en ICT","lvl":"Hoger"},
    {"s":"Onderwijs - pedagogisch","n":"Docenten hbo / wo economie en recht","lvl":"Hoger"},
    {"s":"Zorg","n":"Huishoudelijk medewerkers (particulieren en thuiszorg)","lvl":"Basis"},
    {"s":"Zorg","n":"Helpenden","lvl":"Middelbaar"},
    {"s":"Zorg","n":"(Assistent-)woonbegeleiders","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Verzorgenden (individuele gezondheidszorg (ig), instelling, kraamzorg)","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Algemeen verpleegkundigen","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Medewerkers steriele medische hulpmiddelen","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Orthopedisch (prothese) technici","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Apothekersassistenten","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Tandartsassistenten","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Doktersassistenten","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Medisch secretaressen","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Medisch pedicures","lvl":"Middelbaar"},
    {"s":"Zorg","n":"Podotherapeuten","lvl":"Hoger"},
    {"s":"Zorg","n":"Wijkverpleegkundigen","lvl":"Hoger"},
    {"s":"Zorg","n":"Gespecialiseerd verpleegkundigen (o.a. intensive care, kinder, oncologie, spoedeisende hulp, ambulance, geriatrie, gehandicaptenzorg, psychiatrie, GGZ)","lvl":"Hoger"},
    {"s":"Zorg","n":"(Verpleegkundig) teamleiders zorg en zorgcoördinatoren","lvl":"Hoger"},
    {"s":"Zorg","n":"Coördinatoren groeps- en woonbegeleiders","lvl":"Hoger"},
    {"s":"Zorg","n":"Praktijkondersteuners huisarts","lvl":"Hoger"},
    {"s":"Zorg","n":"Verpleegkundig specialisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Physician assistants","lvl":"Hoger"},
    {"s":"Zorg","n":"Mondhygiënisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Ergotherapeuten","lvl":"Hoger"},
    {"s":"Zorg","n":"Fysiotherapeuten","lvl":"Hoger"},
    {"s":"Zorg","n":"Logopedisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Diëtisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Anesthesiemedewerkers en operatieassistenten","lvl":"Hoger"},
    {"s":"Zorg","n":"Hersen-, hart- en longfunctie laboranten en technici","lvl":"Hoger"},
    {"s":"Zorg","n":"Tandtechnici","lvl":"Hoger"},
    {"s":"Zorg","n":"Radiodiagnostisch laboranten","lvl":"Hoger"},
    {"s":"Zorg","n":"Medisch en pathologisch analisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Arbeidshygiënisten","lvl":"Hoger"},
    {"s":"Zorg","n":"Orthopedagogen","lvl":"Hoger"},
    {"s":"Zorg","n":"Tandartsen","lvl":"Hoger"},
    {"s":"Zorg","n":"Huisartsen","lvl":"Hoger"},
    {"s":"Zorg","n":"Apothekers","lvl":"Hoger"},
    {"s":"Zorg","n":"Dierenartsen","lvl":"Hoger"},
    {"s":"Zorg","n":"Gz-psychologen, klinisch psychologen","lvl":"Hoger"},
    {"s":"Zorg","n":"Sociotherapeuten","lvl":"Hoger"},
    {"s":"Zorg","n":"Psychiaters","lvl":"Hoger"},
    {"s":"Zorg","n":"Specifieke geneeskundige specialisten (o.a. spoedeisende hulp, ouderengeneeskunde, verstandelijk gehandicapten)","lvl":"Hoger"},
    {"s":"Zorg","n":"Bedrijfsartsen, verzekeringsartsen","lvl":"Hoger"},
    {"s":"Zorg","n":"Sociaal geneeskundigen maatschappij en gezondheid (o.a. jeugdgezondheidszorg, infectieziekten, forensisch, vertrouwensartsen)","lvl":"Hoger"}
  ].map(b => ({...b, info:"Uit UWV-lijst kansrijke beroepen 2025-2026", url:""}));

  // =====================================================================
  // STATE
  // FIX v10: versie gebumped zodat gecachte samengevoegde namen worden gewist
  // =====================================================================
  const STORAGE_KEY   = 'bp2026_data_v10';
  const STORAGE_STATE = 'bp2026_user_v10';

  // Wis ALLE oude versies
  Object.keys(localStorage)
    .filter(k => k.startsWith('bp2026_data_') && k !== STORAGE_KEY)
    .forEach(k => localStorage.removeItem(k));

  // Bullet-tekens die gebruikt worden in de PDF (voor detectie en splits)
  const BULLET_CHARS = /[\u25AA\u25aa\u25cf\u2022\u25a0\u25AB\u25ab]/;

  let beroepen  = loadData() || INGEBOUWDE_DATA;
  let userState = loadUserState();

  function isValidBeroep(b) {
    if (!b || !b.n || !b.s || !b.lvl) return false;
    // Naam mag geen bullet-tekens bevatten (samengestelde naam = fout)
    if (BULLET_CHARS.test(b.n)) return false;
    // Naam mag niet te kort zijn
    if (b.n.trim().length < 3) return false;
    return true;
  }

  function loadData() {
    try {
      const r = JSON.parse(localStorage.getItem(STORAGE_KEY));
      if (!r?.beroepen?.length) return null;
      const valid = r.beroepen.filter(isValidBeroep);
      if (valid.length < r.beroepen.length * 0.85) return null;
      return valid;
    } catch { return null; }
  }

  function saveData(d) {
    // Filter nogmaals voor opslaan
    const clean = d.filter(isValidBeroep);
    localStorage.setItem(STORAGE_KEY, JSON.stringify({ savedAt: new Date().toISOString(), beroepen: clean }));
    beroepen = clean;
    updateBadge();
    updatePdfBanner();
  }

  function loadUserState() {
    try { return JSON.parse(localStorage.getItem(STORAGE_STATE)) || {}; } catch { return {}; }
  }
  function saveUserState() {
    localStorage.setItem(STORAGE_STATE, JSON.stringify(userState));
  }

  function esc(s) {
    return (s||'')
      .replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;')
      .replace(/"/g,'&quot;').replace(/'/g,'&#039;');
  }

  function updateBadge() {
    try {
      const r = JSON.parse(localStorage.getItem(STORAGE_KEY));
      const dt = r?.savedAt ? new Date(r.savedAt) : null;
      document.getElementById('dataBadge').textContent = dt
        ? `Bijgewerkt: ${dt.toLocaleString('nl-NL')}`
        : `Standaard 2025-2026 · ${beroepen.length} beroepen`;
    } catch {
      document.getElementById('dataBadge').textContent = `${beroepen.length} beroepen`;
    }
  }

  function getKey(b){ return `${b.s}||${b.n}`.toLowerCase(); }

  function getEntry(b) {
    const k = getKey(b);
    if (!userState[k]) userState[k] = { like: false, doelgroep: false, note: '' };
    return userState[k];
  }

  // =====================================================================
  // BANNER LOGICA
  // =====================================================================
  function hasRealWerkLinks() {
    return (beroepen || []).some(b => {
      const u = (b.url || '').trim();
      return /^https?:\/\/www\.werk\.nl\//i.test(u) && u.length > 20;
    });
  }

  function updatePdfBanner() {
    const banner = document.getElementById('pdfBanner');
    if (!banner) return;
    if (hasRealWerkLinks()) banner.classList.add('hidden');
    else banner.classList.remove('hidden');
  }

  // =====================================================================
  // TABS
  // =====================================================================
  function showPortal() {
    document.getElementById('portalView').classList.remove('hidden');
    document.getElementById('settingsView').classList.add('hidden');
    document.getElementById('tabPortalBtn').style.cssText   = 'background:var(--blue);color:white;';
    document.getElementById('tabSettingsBtn').style.cssText = 'background:white;color:#374151;border:1px solid #e5e7eb;';
  }
  function showSettings() {
    document.getElementById('settingsView').classList.remove('hidden');
    document.getElementById('portalView').classList.add('hidden');
    document.getElementById('tabSettingsBtn').style.cssText = 'background:var(--blue);color:white;';
    document.getElementById('tabPortalBtn').style.cssText   = 'background:white;color:#374151;border:1px solid #e5e7eb;';
  }

  // =====================================================================
  // FILTERS
  // =====================================================================
  document.getElementById('searchInput').addEventListener('keyup', filterContent);
  document.getElementById('levelFilter').addEventListener('change', filterContent);
  document.getElementById('sectorFilter').addEventListener('change', filterContent);
  document.getElementById('selectedFilter').addEventListener('change', filterContent);

  function resetFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('levelFilter').value = 'all';
    document.getElementById('sectorFilter').value = 'all';
    document.getElementById('selectedFilter').value = 'all';
    filterContent();
  }

  function refreshSectorDropdown() {
    const sel = document.getElementById('sectorFilter');
    const current = sel.value;
    const sectors = [...new Set(beroepen.map(b => b.s))].sort((a,b) => a.localeCompare(b,'nl'));
    sel.innerHTML = '<option value="all">Alle sectoren</option>' +
      sectors.map(s => `<option value="${esc(s)}"${s === current ? ' selected' : ''}>${esc(s)}</option>`).join('');
  }

  function filterContent() {
    const q    = document.getElementById('searchInput').value.toLowerCase();
    const lvl  = document.getElementById('levelFilter').value;
    const sec  = document.getElementById('sectorFilter').value;
    const sel  = document.getElementById('selectedFilter').value === 'selected';
    render(q, lvl, sec, sel);
  }

  // =====================================================================
  // RENDER
  // =====================================================================
  function lvlBadge(lvl) {
    if ((lvl||'').includes('Hoger')) return 'lvl-hoger';
    if ((lvl||'').includes('Basis')) return 'lvl-basis';
    return 'lvl-mid';
  }
  function lvlLabel(lvl) {
    if ((lvl||'').includes('Hoger')) return 'HBO/WO';
    if ((lvl||'').includes('Basis')) return 'BASIS';
    return 'MBO';
  }

  function werkNlSearchUrl(name) {
    return `https://www.werk.nl/werkzoekenden/beroepen-en-opleidingen/beroepen/zoeken?zoekterm=${encodeURIComponent(name)}`;
  }

  function normalizeWerkUrl(url){
    const u = (url||'').trim();
    if (/^https?:\/\/www\.werk\.nl\//i.test(u)) return u;
    return '';
  }

  function render(q='', lvl='all', sec='all', onlySel=false) {
    const container = document.getElementById('beroepenContainer');
    container.innerHTML = '';

    const filtered = beroepen.filter(b => {
      const entry = getEntry(b);
      const mQ  = !q || (b.n||'').toLowerCase().includes(q) || (b.s||'').toLowerCase().includes(q);
      const mL  = lvl === 'all' || (b.lvl||'').includes(lvl);
      const mS  = sec === 'all' || b.s === sec;
      const mSel = !onlySel || entry.like;
      return mQ && mL && mS && mSel;
    });

    document.getElementById('statusLine').textContent = `${filtered.length} van ${beroepen.length} beroepen`;

    filtered.forEach(b => {
      const entry  = getEntry(b);
      const k      = getKey(b);
      const pdfUrl = normalizeWerkUrl(b.url);
      const infoUrl = pdfUrl || werkNlSearchUrl(b.n);

      const card = document.createElement('div');
      card.className = 'card bg-white rounded-2xl p-5 shadow-sm border border-slate-100 flex flex-col justify-between';

      card.innerHTML = `
        <div>
          <div class="flex justify-between items-start gap-2 mb-2">
            <span class="text-[10px] font-bold uppercase tracking-widest text-slate-400 leading-tight">${esc(b.s)}</span>
            <span class="px-2 py-0.5 rounded text-[10px] font-bold uppercase flex-shrink-0 ${lvlBadge(b.lvl)}">${lvlLabel(b.lvl)}</span>
          </div>

          <h3 class="text-base font-bold mb-3 leading-snug" style="color:var(--blue)">${esc(b.n)}</h3>

          <label class="flex items-center gap-2 cursor-pointer mb-3 group">
            <input data-k="${esc(k)}" data-f="like" type="checkbox"
                   class="w-4 h-4 rounded cursor-pointer" style="accent-color:var(--orange);"
                   ${entry.like ? 'checked' : ''}>
            <span class="text-sm font-semibold text-slate-700 group-hover:text-orange-600 transition-colors">Vind ik leuk</span>
          </label>

          <label class="flex items-center gap-2 cursor-pointer mb-4">
            <input data-k="${esc(k)}" data-f="doelgroep" type="checkbox"
                   class="w-4 h-4 rounded cursor-pointer" style="accent-color:var(--mid);"
                   ${entry.doelgroep ? 'checked' : ''}>
            <span class="text-sm text-slate-500">Doelgroep-registratie</span>
          </label>
        </div>

        <div class="space-y-2.5">
          <textarea data-k="${esc(k)}" data-f="note"
            placeholder="Notities: wat trekt me aan? Wat houdt me tegen?"
            class="w-full bg-slate-50 border border-slate-100 rounded-xl p-3 text-xs text-slate-700 leading-relaxed">${esc(entry.note||'')}</textarea>

          <a href="${esc(infoUrl)}" target="_blank" rel="noopener"
             class="inline-flex items-center gap-1 text-xs font-semibold hover:underline"
             style="color:var(--mid);">
            ℹ Meer info op Werk.nl
          </a>
        </div>
      `;
      container.appendChild(card);
    });

    container.querySelectorAll('input[type=checkbox]').forEach(cb => {
      cb.addEventListener('change', e => {
        const k = e.target.dataset.k, f = e.target.dataset.f;
        userState[k] = userState[k] || { like:false, doelgroep:false, note:'' };
        userState[k][f] = e.target.checked;
        saveUserState();
        if (document.getElementById('selectedFilter').value === 'selected') filterContent();
      });
    });

    container.querySelectorAll('textarea').forEach(ta => {
      ta.addEventListener('input', e => {
        const k = e.target.dataset.k, f = e.target.dataset.f;
        userState[k] = userState[k] || { like:false, doelgroep:false, note:'' };
        userState[k][f] = e.target.value;
        saveUserState();
      });
    });
  }

  // =====================================================================
  // PDF PARSER — FIX: elke bullet wordt een eigen beroep (geen samenvoegen)
  // =====================================================================
  const SECTORS_LIST = [
    "Bouw","Installatie","Voertuigentechniek","Industrie",
    "Transport - logistiek","Veiligheid","Detailhandel","Horeca",
    "Landbouw, natuur en milieu","Schoonmaak - reiniging",
    "Commercieel \u2013 HR - strategie","Financieel en administratie \u2013 juridisch",
    "ICT","Overheid","Onderwijs - pedagogisch","Zorg"
  ];

  function normalizeSector(t) {
    return (t||'').replace(/\s*-\s*/g,' - ').replace(/\s*\u2013\s*/g,' \u2013 ').replace(/\s+/g,' ').trim();
  }

  function findSector(text) {
    const norm = normalizeSector(text);
    for (const s of SECTORS_LIST) {
      if (norm === s) return s;
      if (norm.startsWith(s) && norm.slice(s.length).trim().length <= 3) return s;
    }
    return null;
  }

  function detectLevel(text) {
    const t = (text||'').toLowerCase();
    if (t.includes('basisvakmanschap') && !t.includes('middelbaar')) return 'Basis';
    if (t.includes('middelbaar beroepsniveau')) return 'Middelbaar';
    if (t.includes('hoger / wetenschappelijk') || t.includes('hoger/wetenschappelijk')) return 'Hoger';
    return null;
  }

  // Verwijder voetnootcijfers en overtollige spaties achteraan
  function cleanName(t) {
    return (t||'')
      .replace(/[\s,]*\d[\d,\s]*$/, '')   // voetnoten aan het einde
      .replace(/\s+/g, ' ')
      .trim();
  }

  function isNoise(t) {
    const s = (t||'').trim();
    if (s.length < 4) return true;
    if (/^[\d\s,.\-\u2013]+$/.test(s)) return true;
    const letters = (s.match(/[A-Za-z\u00C0-\u00FF]/g)||[]).length;
    return letters < 4;
  }

  function isFooter(text) {
    const t = (text||'').toLowerCase().trim();
    if (!t) return true;
    if (t === 'home' || t === 'uwv' || t.startsWith('home ')) return true;
    if (/^kansrijke beroepen/i.test(t)) return true;
    return false;
  }

  function bestLinkForY(links, y, maxDy=8){
    let best = null, bestDy = Infinity;
    for (const l of links) {
      const dy = Math.abs(l.y - y);
      if (dy <= maxDy && dy < bestDy) { bestDy = dy; best = l; }
    }
    return best ? best.url : '';
  }

  async function parsePdfFile(arrayBuffer) {
    if (!window.pdfjsLib) throw new Error('PDF.js niet geladen. Ververs de pagina.');
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

    const pdf = await pdfjsLib.getDocument({ data: arrayBuffer }).promise;
    const allBeroepen = [];

    // Bouw regels op uit items van één kolom
    // Items worden gesorteerd op Y (hoog → laag = boven → onder in PDF.js-coördinaten)
    function buildLines(colItems) {
      const rows = new Map();
      for (const it of colItems) {
        const ky = Math.round(it.y / 3) * 3;
        if (!rows.has(ky)) rows.set(ky, []);
        rows.get(ky).push(it);
      }
      return [...rows.entries()]
        .sort((a, b) => b[0] - a[0]) // aflopend = van boven naar onder
        .map(([ky, arr]) => {
          arr.sort((a, b) => a.x - b.x);
          return {
            y: ky,
            minX: arr[0].x,
            text: arr.map(w => w.text).join(' ').replace(/\s+/g, ' ').trim()
          };
        })
        .filter(l => l.text && !isFooter(l.text));
    }

    // FIX: parseColumn verwerkt elke bullet als een apart beroep.
    // Als een bullet-naam zelf een bullet-teken bevat, wordt die gesplitst.
    function parseColumn(lines, ann, initSector, initLevel) {
      const result = [];
      let sector = initSector;
      let level  = initLevel;

      for (let i = 0; i < lines.length; i++) {
        const { text, minX, y } = lines[i];
        const isBullet = /^[\u25AA\u25aa\u25cf\u2022\u25a0\u25AB\u25ab]/.test(text);

        if (!isBullet) {
          const sec = findSector(text);
          if (sec) { sector = sec; level = null; continue; }
          const lvl = detectLevel(text);
          if (lvl) { level = lvl; continue; }
          continue;
        }

        // Haal tekst op na het bullet-teken
        let bulletText = text.slice(1).trim();

        // Als de bullet zelf leeg is, check de volgende regel
        if (!bulletText && i + 1 < lines.length) {
          const next = lines[i + 1];
          const nextIsBullet = /^[\u25AA\u25aa\u25cf\u2022\u25a0\u25AB\u25ab]/.test(next.text);
          const nextIsHeader = !!findSector(next.text) || !!detectLevel(next.text);
          const gapY = Math.abs(y - next.y);
          if (!nextIsBullet && !nextIsHeader && gapY <= 25) {
            bulletText = next.text.trim();
            i++;
          }
        }

        // Controleer of de volgende regel een afgebroken vervolg is van dezelfde naam
        // (maar ALLEEN als de tekst GEEN bullet-teken bevat)
        if (bulletText && i + 1 < lines.length) {
          const next = lines[i + 1];
          const nextIsBullet = /^[\u25AA\u25aa\u25cf\u2022\u25a0\u25AB\u25ab]/.test(next.text);
          const nextIsHeader = !!findSector(next.text) || !!detectLevel(next.text);
          const gapY = Math.abs(y - next.y);
          const indented = next.minX > minX + 5;
          // Vervolgregel alleen samenvoegen als hij inspringt EN geen bullet-teken bevat
          if (!nextIsBullet && !nextIsHeader && indented && gapY <= 20 && !BULLET_CHARS.test(next.text)) {
            bulletText = (bulletText + ' ' + next.text).replace(/\s+/g, ' ').trim();
            i++;
          }
        }

        // FIX: split op bullet-tekens als er per ongeluk meerdere beroepen in één string zitten
        // Dit vangt gevallen op waarbij de kolomsplitsing niet perfect was
        const subParts = bulletText.split(BULLET_CHARS);

        for (const part of subParts) {
          const name = cleanName(part);
          if (!isNoise(name) && sector && level) {
            const url = bestLinkForY(ann, y, 8);
            result.push({
              s: sector,
              n: name,
              lvl: level,
              info: 'Uit UWV-lijst kansrijke beroepen',
              url: url || ''
            });
          }
        }
      }
      return result;
    }

    for (let p = 1; p <= pdf.numPages; p++) {
      // Sla intro-pagina's en laatste pagina over
      if (p === 1 || p === 2 || p === pdf.numPages) continue;

      const page    = await pdf.getPage(p);
      const vp      = page.getViewport({ scale: 1 });
      const content = await page.getTextContent();

      // Haal annotaties op (Werk.nl links)
      let ann = [];
      try {
        const anns = await page.getAnnotations();
        ann = (anns || [])
          .filter(a => a?.subtype === 'Link' && a.rect)
          .map(a => ({
            url: a.url || (a.action?.url) || '',
            y:   Math.round(((a.rect[1] + a.rect[3]) / 2) / 3) * 3
          }))
          .filter(a => /^https?:\/\/www\.werk\.nl\//i.test(a.url));
      } catch { ann = []; }

      // Alleen items met positieve X-coördinaat (negatieve = achtergrondlaag)
      const items = (content.items || [])
        .filter(it => it.str?.trim() && it.transform[4] > 0)
        .map(it => ({
          x: it.transform[4],
          y: it.transform[5],
          text: it.str.trim().replace(/\u00A0/g, ' ')
        }));

      if (!items.length) continue;

      // Detecteer kolomsplitsing: zoek de gap dichtst bij het midden van de pagina
      const xVals = [...new Set(items.map(it => Math.round(it.x)))].sort((a, b) => a - b);
      const center = vp.width / 2;
      let splitX = center;
      let bestDist = Infinity;
      for (let j = 1; j < xVals.length; j++) {
        const gap = xVals[j] - xVals[j - 1];
        if (gap > 30) {
          const mid = (xVals[j - 1] + xVals[j]) / 2;
          if (mid > vp.width * 0.2 && mid < vp.width * 0.8) {
            const dist = Math.abs(mid - center);
            if (dist < bestDist) { bestDist = dist; splitX = mid; }
          }
        }
      }

      const leftItems  = items.filter(it => it.x < splitX);
      const rightItems = items.filter(it => it.x >= splitX);

      const leftLines  = buildLines(leftItems);
      const rightLines = buildLines(rightItems);

      // Parse linkerkolom
      const leftResult = parseColumn(leftLines, ann, null, null);
      allBeroepen.push(...leftResult);

      // Bepaal de laatste bekende sector/level uit de linkerkolom
      // zodat de rechterkolom die kan erven als die zelf geen eigen header heeft
      let inheritedSector = null, inheritedLevel = null;
      for (const b of [...leftResult].reverse()) {
        if (!inheritedSector && b.s) inheritedSector = b.s;
        if (!inheritedLevel && b.lvl) inheritedLevel = b.lvl;
        if (inheritedSector && inheritedLevel) break;
      }
      // Fallback: scan leftLines voor de laatste sector/level header
      if (!inheritedSector || !inheritedLevel) {
        for (const line of [...leftLines].reverse()) {
          if (!inheritedSector) {
            const sec = findSector(line.text);
            if (sec) inheritedSector = sec;
          }
          if (!inheritedLevel) {
            const lvl = detectLevel(line.text);
            if (lvl) inheritedLevel = lvl;
          }
          if (inheritedSector && inheritedLevel) break;
        }
      }

      const rightResult = parseColumn(rightLines, ann, inheritedSector, inheritedLevel);
      allBeroepen.push(...rightResult);
    }

    // Dedupliceer op basis van sector + naam
    const seen = new Set();
    return allBeroepen.filter(b => {
      const k = getKey(b);
      if (seen.has(k)) return false;
      seen.add(k);
      return true;
    });
  }

  // =====================================================================
  // INSTELLINGEN ACTIES
  // =====================================================================
  document.getElementById('pdfFileInput').addEventListener('change', async () => {
    const file = document.getElementById('pdfFileInput').files?.[0];
    if (!file) return;
    setMsg('\u23F3 PDF wordt gelezen\u2026', 'slate');
    try {
      const bytes  = await file.arrayBuffer();
      const parsed = await parsePdfFile(bytes);
      if (!parsed.length) {
        setMsg('\u274C Geen beroepen gevonden. Probeer de officiële UWV PDF.', 'red');
        return;
      }
      saveData(parsed);
      refreshSectorDropdown();
      filterContent();
      setMsg(`\u2705 Klaar! ${parsed.length} beroepen ingeladen (met echte "Meer info" links).`, 'green');
      showPortal();
    } catch(e) {
      setMsg(`\u274C Fout: ${e.message}`, 'red');
    }
  });

  function loadDefault() {
    saveData(INGEBOUWDE_DATA);
    refreshSectorDropdown();
    filterContent();
    setMsg('\u2705 Standaard data geladen. (Links zijn dan zoeklinks.)', 'green');
    showPortal();
    updatePdfBanner();
  }

  function clearUserState() {
    localStorage.removeItem(STORAGE_STATE);
    userState = {};
    setMsg('\u2705 Jouw notities en vinkjes zijn gewist.', 'green');
    filterContent();
  }

  function setMsg(msg, color) {
    const colors = { green:'text-emerald-700', red:'text-red-600', slate:'text-slate-600' };
    document.getElementById('settingsMsg').innerHTML =
      `<span class="font-semibold ${colors[color]||'text-slate-600'}">${esc(msg)}</span>`;
  }

  // =====================================================================
  // EXPORT (print)
  // =====================================================================
  document.getElementById('exportBtn').addEventListener('click', () => {
    const orientEl = document.getElementById('printOrientation');
    const orient = orientEl ? orientEl.value : 'portrait';
    applyPrintOrientation(orient);
    buildExport();
    window.print();
  });

  function applyPrintOrientation(mode){
    const el = document.getElementById('printPageStyle');
    const size = (mode === 'landscape') ? 'A4 landscape' : 'A4 portrait';
    el.textContent = `@media print { @page { size: ${size}; margin: 12mm; } }`;
  }

  function buildExport() {
    const selected = beroepen
      .map(b => ({ b, entry: getEntry(b) }))
      .filter(x => x.entry.like);

    const exportList = document.getElementById('exportList');
    exportList.innerHTML = '';

    const now = new Date();
    document.getElementById('exportMeta').textContent = `Aangemaakt: ${now.toLocaleString('nl-NL')}`;
    document.getElementById('exportSubtitle').textContent =
      selected.length
        ? `${selected.length} beroep${selected.length !== 1 ? 'en' : ''} geselecteerd`
        : 'Geen beroepen geselecteerd';

    if (!selected.length) {
      exportList.innerHTML = `
        <div class="p-5 border rounded-xl bg-slate-50 text-slate-600 text-sm">
          Je hebt nog geen beroepen aangevinkt. Ga naar het portaal en vink beroepen aan via "Aangevinkt".
        </div>`;
      return;
    }

    const groups = {};
    for (const item of selected) {
      const s = item.b.s || 'Overig';
      if (!groups[s]) groups[s] = [];
      groups[s].push(item);
    }

    const lvlOrder = { Basis:0, Middelbaar:1, Hoger:2 };

    function lvlBadgeCls(lvl){
      if ((lvl||'').includes('Hoger')) return 'lvl-hoger';
      if ((lvl||'').includes('Basis')) return 'lvl-basis';
      return 'lvl-mid';
    }
    function lvlLbl(lvl){
      if ((lvl||'').includes('Hoger')) return 'HBO/WO';
      if ((lvl||'').includes('Basis')) return 'BASIS';
      return 'MBO';
    }

    for (const sector of Object.keys(groups).sort((a,b) => a.localeCompare(b,'nl'))) {
      const items = groups[sector].sort((a,b) =>
        (lvlOrder[a.b.lvl]||9) - (lvlOrder[b.b.lvl]||9) ||
        (a.b.n||'').localeCompare((b.b.n||''),'nl')
      );

      const block = document.createElement('div');
      block.className = 'export-card rounded-2xl overflow-hidden';

      const header = document.createElement('div');
      header.className = 'export-sector-header px-5 py-3 border-b border-slate-200';
      header.innerHTML = `<div class="font-bold text-sm uppercase tracking-wider" style="color:var(--blue)">${esc(sector)}</div>`;
      block.appendChild(header);

      const body = document.createElement('div');
      body.className = 'divide-y divide-slate-100';

      for (const { b, entry } of items) {
        const row = document.createElement('div');
        row.className = 'px-5 py-4';

        const note = (entry.note || '').trim();
        const doelgroepTxt = entry.doelgroep ? 'Ja' : 'Nee';

        row.innerHTML = `
          <div class="flex items-start justify-between gap-3 mb-1">
            <div class="font-semibold text-sm leading-snug" style="color:var(--blue)">${esc(b.n)}</div>
            <span class="px-2 py-0.5 rounded text-[10px] font-bold flex-shrink-0 export-lvl-badge ${lvlBadgeCls(b.lvl)}">${lvlLbl(b.lvl)}</span>
          </div>
          <div class="text-xs text-slate-500 mt-1">
            Doelgroep-registratie: <span class="font-semibold text-slate-700">${doelgroepTxt}</span>
          </div>
          ${note
            ? `<div class="text-sm text-slate-700 leading-relaxed mt-2 bg-slate-50 rounded-lg p-3">${esc(note)}</div>`
            : `<div class="text-xs text-slate-400 mt-2 italic">Geen notities ingevuld.</div>`
          }
        `;
        body.appendChild(row);
      }

      block.appendChild(body);
      exportList.appendChild(block);
    }
  }

  // =====================================================================
  // INIT
  // =====================================================================
  function init() {
    showPortal();
    updateBadge();
    refreshSectorDropdown();
    filterContent();
    updatePdfBanner();
  }

  window.addEventListener('load', () => {
    if (window.pdfjsLib) {
      pdfjsLib.GlobalWorkerOptions.workerSrc =
        'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    }
  });
  </script>

  <!-- PDF.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>init();</script>

</body>
</html>
